sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","com/sagenet/zfunctionallocationlookup/utils/formatter"],function(e,t,i,s,o){"use strict";return e.extend("com.sagenet.zfunctionallocationlookup.controller.HomeView",{formatter:o,onInit:function(){var e=this.byId("idSiteTable");this._mViewSettingsDialogs={};this.oModel=new s({isFilterBarVisible:false,filterBarLabel:"",delay:0,title:this.getResourceBundle().getText("masterTitleCount",[0]),noDataText:this.getResourceBundle().getText("masterListNoDataText"),sortBy:"None",groupBy:"None"});this.oModel.setSizeLimit(1e3);var i=this;this.getView().setModel(this.oModel);var o=new t("Country","EQ","US");this.getOwnerComponent().getModel("StateModel").read("/StateSet",{filters:[o],success:function(e){sap.ui.core.BusyIndicator.hide();i.oModel.setProperty("/StateData",e.results);if(e.results.length===0){sap.m.MessageToast.show("No records found for this selection criteria.!")}},error:function(e){sap.ui.core.BusyIndicator.hide();sap.m.MessageToast.show("No Data Found.!");i.oModel.setProperty("/StateData",[])}});this._oList=e;this._oListFilterState={aFilter:[],aSearch:[]}},onValueHelpRequestState:function(e){var s=e.getSource().getValue();this.byId("idState").setValueState("None");this.inputId=e.getSource().getId();if(!this._valueHelpDialogS){this._valueHelpDialogS=sap.ui.xmlfragment("com.sagenet.zfunctionallocationlookup.view.stateDialog",this);this.getView().addDependent(this._valueHelpDialogS)}var o=new t("RegionDescription",i.Contains,s);this._valueHelpDialogS.getBinding("items").filter([o]);this._valueHelpDialogS.open(s)},onValueHelpSearch:function(e){var s=e.getParameter("value");var o=e.oSource.mProperties.title;var a;if(o==="State"){a=new t("RegionDescription",i.Contains,s)}e.getSource().getBinding("items").filter([a])},onValueHelpClose:function(e){var t=e.getParameter("selectedItem");e.getSource().getBinding("items").filter([]);if(!t){return}var i=e.oSource.mProperties.title;if(i==="State"){this.byId("idState").setValue(t.getTitle())}},onRefresh:function(){this._oList.getBinding("items").refresh()},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh();return}this._applyFilterSearch()},_applyFilterSearch:function(){var e=this.getView().byId("filterbar");var i=this.getView().byId("filterbar").getAllFilterItems();var s=[];var o=this.getView();i.map(function(i){var o=i.getName();var a=e.determineControlByFilterItem(i);var r;if(a.getMetadata().getName()==="sap.m.Input"){r=a.getValue()}else{r=""}if(r.length!==0){if(o==="Program"){o="ProjectDefinition"}var n=new t(o,"Contains",r);s.push(n)}});this.fetchSiteData(false,s)},fetchSiteData:function(e,t){var i=this;var s;if(!e){s=new sap.ui.model.Filter({filters:t,and:true})}sap.ui.core.BusyIndicator.show();this.getOwnerComponent().getModel("SiteModel").read("/SiteList",{filters:t,success:function(e){i.getView().getModel().setProperty("/SiteData",e.results);var t=[];var s=[];var o=[];var a=[];var r=[];var n=[];var l=[];var u=[];var g=[];for(let i=0;i<e.results.length;i++){if(!t[e.results[i].Status]){s.push(e.results[i].Status);t[e.results[i].Status]=1;var c={statusName:e.results[i].Status};o.push(c)}if(!a[e.results[i].FunctionalLocation]){r.push(e.results[i].FunctionalLocation);a[e.results[i].FunctionalLocation]=1;var c={funcLocName:e.results[i].FunctionalLocation};n.push(c)}if(!l[e.results[i].Name1]){u.push(e.results[i].Name1);l[e.results[i].Name1]=1;var c={Name1:e.results[i].Name1};g.push(c)}}i.getView().getModel().setProperty("/Status",o);i.getView().getModel().setProperty("/FuncLoc",n);i.getView().getModel().setProperty("/Name1",g);sap.ui.core.BusyIndicator.hide()},error:function(e){sap.m.MessageToast.show("No Site Details Found.!");sap.ui.core.BusyIndicator.hide();i.getView().getModel().setProperty("/SiteData","")}})},_updateListItemCount:function(e){var t;if(this._oList.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("masterTitleCount",[e]);this.getView().byId("idTableHeader").setText(t)}},onUpdateFinished:function(e){this._updateListItemCount(e.getParameter("total"))},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},onExit:function(){sap.ui.core.BusyIndicator.hide()},openSiteDetailsDialog:function(e){var t=e.oSource.getCells()[0].mProperties.title;this.getView().getModel().setProperty("/SitePartsData",[]);this.fetchSitePartDetails(t);if(!this._oDialog){this._oDialog=sap.ui.xmlfragment("com.sagenet.zfunctionallocationlookup.view.siteDetailsDialog",this)}this.getView().addDependent(this._oDialog);this._oDialog.setContentWidth("70rem");this._oDialog.setTitle("Parts On Site for "+t);jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this._oDialog);this._oDialog.open()},fetchSitePartDetails:function(e){sap.ui.core.BusyIndicator.show();var t=this;this.getOwnerComponent().getModel("SiteModel").read("/SiteList('"+e+"')/GetSiteParts",{success:function(e){t.getView().getModel().setProperty("/SitePartsData",e.results);sap.ui.core.BusyIndicator.hide()},error:function(e){sap.m.MessageToast.show("No Site Parts Details Found.!");sap.ui.core.BusyIndicator.hide();t.getView().getModel().setProperty("/SitePartsData","")}})},onSitePartsClose:function(){this._oDialog.close()},handleSitePartsDialogClose:function(){},getViewSettingsDialog:function(e){var t=this._mViewSettingsDialogs[e];if(!t){t=sap.ui.xmlfragment(e,this);this._mViewSettingsDialogs[e]=t}jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),t);t.open();t.setModel(this.getView().getModel());return t},handleSortButtonPressed:function(){this.getViewSettingsDialog("com.sagenet.zfunctionallocationlookup.view.viewSortDialog")},handleSortDialogConfirm:function(e){var t=this.byId("idSiteTable"),i=e.getParameters(),s=t.getBinding("items"),o,a,r=[];o=i.sortItem.getKey();a=i.sortDescending;r.push(new sap.ui.model.Sorter(o,a));s.sort(r)},handleFilterButtonPressed:function(){this.getViewSettingsDialog("com.sagenet.zfunctionallocationlookup.view.viewFilterDialog")},handleFilterDialogConfirm:function(e){var i=this.byId("idSiteTable"),s=e.getParameters(),o=i.getBinding("items"),a=[];s.filterItems.forEach(function(e){if(e.getKey()==="Status"){var i=new t("Status","EQ",e.getText());a.push(i)}else if(e.getKey()==="FunctionalLocation"){var i=new t("FunctionalLocation","EQ",e.getText());a.push(i)}else if(e.getKey()==="Name1"){var i=new t("Name1","EQ",e.getText());a.push(i)}});o.filter(a);this.byId("vsdFilterBar").setVisible(a.length>0);this.byId("vsdFilterLabel").setText(s.filterString)},handleRemoveFilterButtonPressed:function(){var e=this.byId("idSiteTable").getBinding("items");e.filter([]);this.byId("vsdFilterBar").setVisible(false);this.byId("vsdFilterLabel").setText("")}})});